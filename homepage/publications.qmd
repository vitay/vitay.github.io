---
title: "Publications"
echo: false
jupyter: python3
section-divs: false
keep-md: true
---

```{python}
import yaml
from IPython.display import display, Markdown, HTML

def readable_list(_s):
    if len(_s) < 3:
        return ' and '.join(map(str, _s))
    *a, b = _s
    return f"{', '.join(map(str, a))}, and {b}"

def button(url, str, icon):
    icon_base = icon[:2]
    return f"""<a class="btn btn-outline-dark btn-sm" href="{url}" target="_blank" rel="noopener noreferrer"> <i class="{icon_base} {icon}" role='img' aria-label='{str}'></i> {str}</a>"""

def format_citation(data):

    # Basic info
    title_str = data["title"]
    author_str = readable_list(data.get("authors"))
    year_str = data["year"]
    journal = data.get("journal")
    doi = data.get("doi")
    url = data.get("url")

    # Build the markdown
    md_string = f"""
{author_str} ({year_str}) <br>
**{title_str}**  <br>
"""
    if journal is not None:
        md_string += f"{journal}  <br>\n"
    if doi is not None:
        md_string += f'[doi:{doi}](https://doi.org/{doi}) <br>\n'

    # Buttons
    buttons = []

    pub_url = data.get("url")
    if pub_url is not None:
        buttons.append(button(pub_url, "URL", "bi-journal"))

    pdf = data.get("pdf")
    if pdf is not None:
        buttons.append(button(pdf, "PDF", "bi-file-earmark-pdf"))

    preprint = data.get("preprint")
    if preprint is not None:
        buttons.append(button(preprint, "Preprint", "bi-file-earmark-pdf"))
        
    github = data.get("github")
    if github is not None:
        buttons.append(button(github, "Code", "bi-github"))

    poster = data.get("poster")
    if poster is not None:
        buttons.append(button(poster, "Poster", "bi-file-earmark-easel"))

    # Append
    return md_string + "\n\n" + "\n".join(buttons) + "\n\n---\n\n"


# Read the yaml file
yaml_data = yaml.safe_load(open("papers.yaml"))

# Process the descriptions as they come
md_code = {}
for _, data in yaml_data.items():

    # Format the citation
    md = format_citation(data)

    # Create the year if not existing yet
    year_str = data["year"]
    if year_str not in md_code:
        md_code[year_str] = []

    # Group by year
    md_code[year_str].append(md)

```


```{python}
#| label: "published-year"
#| id: "published-year"
#| output: asis 
for year in sorted(md_code.keys(), reverse=True):
    # Organize per year
    display(Markdown(f"### {year}" + " {#" + f"published-{year}" + "}"))
    # Show the markdown
    display(Markdown('\n'.join(md_code[year])))
```

